<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>DME Documentation Dashboard</title>
  <style>
    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      margin: 0;
      padding: 0;
      line-height: 1.5;
      color: #333;
      background-color: #f8f9fa;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    header {
      background-color: #2c3e50;
      color: white;
      padding: 15px 0;
      text-align: center;
      margin-bottom: 30px;
      border-radius: 5px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    h1 {
      margin: 0;
      font-size: 24px;
    }
    h2 {
      font-size: 20px;
      margin-top: 0;
      color: #2c3e50;
    }
    /* Category controls */
    .category-controls {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 20px;
      background-color: #edf2f7;
      padding: 15px;
      border-radius: 5px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    .category-button {
      padding: 10px 15px;
      background-color: #6c757d;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.2s;
    }
    .category-button.active {
      background-color: #2c3e50;
      box-shadow: 0 0 5px rgba(44, 62, 80, 0.5);
    }
    .search-box {
      width: 100%;
      padding: 10px;
      margin-bottom: 20px;
      border: 1px solid #ced4da;
      border-radius: 4px;
      font-size: 16px;
    }
    
    /* DME Grid */
    .dme-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    .dme-card {
      background-color: white;
      border-radius: 5px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      overflow: hidden;
      transition: transform 0.2s;
      height: 100%;
      display: flex;
      flex-direction: column;
    }
    .dme-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    .dme-header {
      background-color: #3498db;
      color: white;
      padding: 15px;
      font-weight: bold;
      font-size: 16px;
    }
    .mobility .dme-header {
      background-color: #3498db; /* Blue */
    }
    .support_surfaces .dme-header {
      background-color: #e74c3c; /* Red */
    }
    .hospital_beds .dme-header {
      background-color: #2ecc71; /* Green */
    }
    .oxygen .dme-header {
      background-color: #9b59b6; /* Purple */
    }
    .respiratory .dme-header {
      background-color: #f39c12; /* Orange */
    }
    .nebulizer .dme-header {
      background-color: #1abc9c; /* Teal */
    }
    .dme-comment {
      background-color: #fff9c4; /* Light yellow */
      padding: 10px;
      font-size: 14px;
      border-bottom: 1px solid #ffe082;
    }
    .dme-content {
      padding: 15px;
      flex-grow: 1;
    }
    .dme-footer {
      padding: 10px 15px;
      background-color: #f8f9fa;
      text-align: right;
      border-top: 1px solid #e9ecef;
    }
    .view-button {
      background-color: #3498db;
      color: white;
      border: none;
      border-radius: 4px;
      padding: 8px 12px;
      cursor: pointer;
      font-size: 14px;
    }
    .view-button:hover {
      background-color: #2980b9;
    }
    
    /* Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.5);
      z-index: 1000;
      overflow-y: auto;
    }
    .modal-content {
      background-color: white;
      margin: 50px auto;
      padding: 20px;
      width: 80%;
      max-width: 800px;
      border-radius: 5px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
      position: relative;
    }
    .close-button {
      position: absolute;
      top: 10px;
      right: 10px;
      font-size: 24px;
      cursor: pointer;
      color: #aaa;
    }
    .close-button:hover {
      color: #333;
    }
    .tab-buttons {
      display: flex;
      margin-bottom: 15px;
      border-bottom: 1px solid #dee2e6;
    }
    .tab-button {
      padding: 10px 15px;
      background-color: #f8f9fa;
      border: none;
      border-radius: 5px 5px 0 0;
      cursor: pointer;
      margin-right: 5px;
      font-size: 14px;
    }
    .tab-button.active {
      background-color: #3498db;
      color: white;
    }
    .tab-content {
      display: none;
      padding: 15px;
      background-color: #f8f9fa;
      border-radius: 0 0 5px 5px;
    }
    .tab-content.active {
      display: block;
    }
    
    /* Documentation */
    .documentation-title {
      font-weight: bold;
      margin-bottom: 10px;
      color: #2c3e50;
    }
    .documentation-list {
      list-style-type: disc;
      padding-left: 20px;
      margin-bottom: 15px;
    }
    .documentation-list li {
      margin-bottom: 5px;
    }
    
    /* Dot Phrase */
    .dot-phrase-section {
      margin-top: 20px;
    }
    .dot-phrase-textarea {
      width: 100%;
      height: 200px;
      padding: 10px;
      font-family: monospace;
      font-size: 14px;
      border: 1px solid #ced4da;
      border-radius: 4px;
      background-color: #f8f9fa;
      resize: vertical;
    }
    .action-buttons {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }
    .copy-button, .email-button {
      padding: 10px 15px;
      background-color: #2ecc71;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
    }
    .copy-button:hover, .email-button:hover {
      background-color: #27ae60;
    }
    .email-button {
      background-color: #3498db;
    }
    .email-button:hover {
      background-color: #2980b9;
    }
    .email-form {
      display: none;
      margin-top: 15px;
      padding: 15px;
      background-color: #edf2f7;
      border-radius: 5px;
    }
    .email-input {
      width: 100%;
      padding: 10px;
      margin-bottom: 10px;
      border: 1px solid #ced4da;
      border-radius: 4px;
    }
    .send-button {
      padding: 10px 15px;
      background-color: #3498db;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    
    /* Diagnoses Section */
    .diagnoses {
      margin-top: 15px;
    }
    .diagnoses-title {
      font-weight: bold;
      margin-bottom: 10px;
      color: #2c3e50;
    }
    .diagnoses-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    .diagnoses-table th, .diagnoses-table td {
      padding: 8px;
      text-align: left;
      border-bottom: 1px solid #e9ecef;
      font-size: 14px;
    }
    .diagnoses-table th {
      background-color: #f8f9fa;
      font-weight: bold;
    }
    .diagnoses-table tr:hover {
      background-color: #f1f1f1;
    }
    .loading {
      text-align: center;
      padding: 50px;
      font-size: 18px;
      color: #777;
    }
    .no-results {
      text-align: center;
      padding: 50px;
      font-size: 18px;
      color: #777;
    }
    .category-label {
      background-color: #e9ecef;
      padding: 5px 10px;
      border-radius: 15px;
      font-size: 12px;
      color: #495057;
      display: inline-block;
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <header>
    <div class="container">
      <h1>DME Documentation & Dot Phrase Generator</h1>
    </div>
  </header>
  
  <div class="container">
    <!-- Search and Category Controls -->
    <input type="text" id="searchBox" class="search-box" placeholder="Search for DME items...">
    
    <div class="category-controls">
      <button id="all-category" class="category-button active">All Categories</button>
      <button id="mobility-category" class="category-button">Mobility Equipment</button>
      <button id="support_surfaces-category" class="category-button">Support Surfaces</button>
      <button id="hospital_beds-category" class="category-button">Hospital Beds</button>
      <button id="oxygen-category" class="category-button">Oxygen Equipment</button>
      <button id="respiratory-category" class="category-button">Respiratory Equipment</button>
      <button id="nebulizer-category" class="category-button">Nebulizers</button>
    </div>
    
    <!-- DME Items Grid -->
    <div id="dmeGrid" class="dme-grid">
      <div class="loading">Loading DME items...</div>
    </div>
    
    <!-- DME Details Modal -->
    <div id="dmeModal" class="modal">
      <div class="modal-content">
        <span class="close-button" id="closeModal">&times;</span>
        <h2 id="modalTitle">DME Item Details</h2>
        
        <div class="tab-buttons">
          <button class="tab-button active" data-tab="documentation">Documentation Requirements</button>
          <button class="tab-button" data-tab="dotphrase">Dot Phrase</button>
          <button class="tab-button" data-tab="diagnoses">Diagnoses Codes</button>
        </div>
        
        <div id="documentation-tab" class="tab-content active">
          <div id="commentSection" class="dme-comment"></div>
          
          <div class="documentation-title">Positive Documentation Required:</div>
          <ul id="positiveDoc" class="documentation-list"></ul>
          
          <div id="negativeSection">
            <div class="documentation-title">Document Absence of:</div>
            <ul id="negativeDoc" class="documentation-list"></ul>
          </div>
          
          <div id="specificationsSection">
            <div class="documentation-title">Specifications:</div>
            <ul id="specifications" class="documentation-list"></ul>
          </div>
        </div>
        
        <div id="dotphrase-tab" class="tab-content">
          <div class="dot-phrase-section">
            <div class="documentation-title">Dot Phrase for EHR System:</div>
            <textarea id="dotPhraseText" class="dot-phrase-textarea" readonly></textarea>
            <div class="action-buttons">
              <button id="copyButton" class="copy-button">Copy Dot Phrase</button>
              <button id="emailButton" class="email-button">Email Dot Phrase</button>
            </div>
            <div id="emailForm" class="email-form">
              <input type="email" id="emailInput" class="email-input" placeholder="Enter your email address" autocomplete="on">
              <button id="sendButton" class="send-button">Send Dot Phrase</button>
            </div>
          </div>
        </div>
        
        <div id="diagnoses-tab" class="tab-content">
          <div class="diagnoses">
            <div class="diagnoses-title">Recommended Diagnosis Codes:</div>
            <table class="diagnoses-table">
              <thead>
                <tr>
                  <th>Code</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody id="diagnosesTable"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Global variables
    let dmeData = [];
    let currentCategory = "all";
    let currentDME = null;
    
    // DOM Elements
    const dmeGrid = document.getElementById("dmeGrid");
    const searchBox = document.getElementById("searchBox");
    const modal = document.getElementById("dmeModal");
    const closeModal = document.getElementById("closeModal");
    const modalTitle = document.getElementById("modalTitle");
    const commentSection = document.getElementById("commentSection");
    const positiveDoc = document.getElementById("positiveDoc");
    const negativeSection = document.getElementById("negativeSection");
    const negativeDoc = document.getElementById("negativeDoc");
    const specificationsSection = document.getElementById("specificationsSection");
    const specifications = document.getElementById("specifications");
    const dotPhraseText = document.getElementById("dotPhraseText");
    const diagnosesTable = document.getElementById("diagnosesTable");
    const tabButtons = document.querySelectorAll(".tab-button");
    const tabContents = document.querySelectorAll(".tab-content");
    const copyButton = document.getElementById("copyButton");
    const emailButton = document.getElementById("emailButton");
    const emailForm = document.getElementById("emailForm");
    const emailInput = document.getElementById("emailInput");
    const sendButton = document.getElementById("sendButton");
    
    // Event Listeners
    document.addEventListener("DOMContentLoaded", initializeApp);
    
    searchBox.addEventListener("input", function() {
      filterDMEItems();
    });
    
    // Category buttons
    document.getElementById("all-category").addEventListener("click", function() {
      setActiveCategory("all");
    });
    
    document.getElementById("mobility-category").addEventListener("click", function() {
      setActiveCategory("mobility");
    });
    
    document.getElementById("support_surfaces-category").addEventListener("click", function() {
      setActiveCategory("support_surfaces");
    });
    
    document.getElementById("hospital_beds-category").addEventListener("click", function() {
      setActiveCategory("hospital_beds");
    });
    
    document.getElementById("oxygen-category").addEventListener("click", function() {
      setActiveCategory("oxygen");
    });
    
    document.getElementById("respiratory-category").addEventListener("click", function() {
      setActiveCategory("respiratory");
    });
    
    document.getElementById("nebulizer-category").addEventListener("click", function() {
      setActiveCategory("nebulizer");
    });
    
    // Modal events
    closeModal.addEventListener("click", function() {
      modal.style.display = "none";
    });
    
    window.addEventListener("click", function(event) {
      if (event.target === modal) {
        modal.style.display = "none";
      }
    });
    
    // Tab navigation
    tabButtons.forEach(button => {
      button.addEventListener("click", function() {
        const tabId = this.getAttribute("data-tab");
        
        // Update active tab button
        tabButtons.forEach(btn => btn.classList.remove("active"));
        this.classList.add("active");
        
        // Update active tab content
        tabContents.forEach(content => content.classList.remove("active"));
        document.getElementById(tabId + "-tab").classList.add("active");
      });
    });
    
    // Copy button
    copyButton.addEventListener("click", function() {
      const textArea = document.getElementById("dotPhraseText");
      textArea.select();
      document.execCommand("copy");
      alert("Dot phrase copied to clipboard!");
    });
    
    // Email button
    emailButton.addEventListener("click", function() {
      if (emailForm.style.display === "block") {
        emailForm.style.display = "none";
      } else {
        emailForm.style.display = "block";
      }
    });
    
    // Send email button
    sendButton.addEventListener("click", function() {
      const email = emailInput.value;
      if (!email || !email.includes("@")) {
        alert("Please enter a valid email address");
        return;
      }
      
      // In a real application, you would send this to your server
      alert(`Dot phrase would be sent to ${email}\n\nThis is a simulation - in a real application, an API call would send the email.`);
      
      // Clear input and hide form
      emailInput.value = "";
      emailForm.style.display = "none";
    });
    
    // App Functions
    function initializeApp() {
      loadDMEData();
    }
    
    function loadDMEData() {
      // In a real app, you would fetch this from a server
      // For this example, we'll use a sample promise to simulate loading
      
      fetchDMEData()
        .then(data => {
          dmeData = data.dme;
          renderDMEGrid();
        })
        .catch(error => {
          console.error("Error loading DME data:", error);
          dmeGrid.innerHTML = `<div class="no-results">Error loading DME data. Please try again later.</div>`;
        });
    }
    
    function fetchDMEData() {
      // In a real app, this would be a fetch call to your server
      // For this example, we'll return a promise that resolves with the sample data
      
      return fetch('dmedot.json')
        .then(response => {
          if (!response.ok) {
            throw new Error('Network response was not ok');
          }
          return response.json();
        });
    }
    
    function setActiveCategory(category) {
      currentCategory = category;
      
      // Update active category button
      document.querySelectorAll(".category-button").forEach(btn => {
        btn.classList.remove("active");
      });
      document.getElementById(category + "-category").classList.add("active");
      
      // Re-render the DME grid
      renderDMEGrid();
    }
    
    function filterDMEItems() {
      renderDMEGrid();
    }
    
    function renderDMEGrid() {
      const searchTerm = searchBox.value.toLowerCase();
      
      // Filter items based on search term and current category
      const filteredItems = dmeData.filter(item => {
        const matchesSearch = !searchTerm || 
          item.name.toLowerCase().includes(searchTerm) || 
          item.showName.toLowerCase().includes(searchTerm) ||
          (item.comment && item.comment.toLowerCase().includes(searchTerm));
        
        const matchesCategory = currentCategory === "all" || item.category === currentCategory;
        
        return matchesSearch && matchesCategory;
      });
      
      if (filteredItems.length === 0) {
        dmeGrid.innerHTML = `<div class="no-results">No DME items found matching your search criteria.</div>`;
        return;
      }
      
      // Build HTML for each DME card
      let html = '';
      filteredItems.forEach(item => {
        html += `
          <div class="dme-card ${item.category}">
            <div class="dme-header">${item.name}</div>
            ${item.comment ? `<div class="dme-comment">${item.comment}</div>` : ''}
            <div class="dme-content">
              <div class="category-label">${getCategoryDisplayName(item.category)}</div>
              <strong>Documentation Required:</strong>
              <ul class="documentation-list">
                ${item.positive_documentation.slice(0, 2).map(doc => `<li>${doc}</li>`).join('')}
                ${item.positive_documentation.length > 2 ? `<li>... and ${item.positive_documentation.length - 2} more requirements</li>` : ''}
              </ul>
            </div>
            <div class="dme-footer">
              <button class="view-button" data-dme="${item.name}">View Documentation</button>
            </div>
          </div>
        `;
      });
      
      dmeGrid.innerHTML = html;
      
      // Add event listeners to view buttons
      document.querySelectorAll(".view-button").forEach(button => {
        button.addEventListener("click", function() {
          const dmeName = this.getAttribute("data-dme");
          openDMEDetails(dmeName);
        });
      });
    }
    
    function getCategoryDisplayName(category) {
      const categoryNames = {
        "mobility": "Mobility Equipment",
        "support_surfaces": "Support Surfaces",
        "hospital_beds": "Hospital Beds",
        "oxygen": "Oxygen Equipment",
        "respiratory": "Respiratory Equipment",
        "nebulizer": "Nebulizers"
      };
      
      return categoryNames[category] || "Other";
    }
    
    function openDMEDetails(dmeName) {
      // Find the DME item
      const dmeItem = dmeData.find(item => item.name === dmeName);
      if (!dmeItem) {
        alert("DME item not found");
        return;
      }
      
      currentDME = dmeItem;
      
      // Update modal title
      modalTitle.textContent = dmeItem.name;
      
      // Update comment section
      if (dmeItem.comment) {
        commentSection.textContent = dmeItem.comment;
        commentSection.style.display = "block";
      } else {
        commentSection.style.display = "none";
      }
      
      // Update positive documentation
      positiveDoc.innerHTML = dmeItem.positive_documentation.map(doc => `<li>${doc}</li>`).join('');
      
      // Update negative documentation
      if (dmeItem.negative_documentation && dmeItem.negative_documentation.length > 0) {
        negativeDoc.innerHTML = dmeItem.negative_documentation.map(doc => `<li>${doc}</li>`).join('');
        negativeSection.style.display = "block";
      } else {
        negativeSection.style.display = "none";
      }
      
      // Update specifications
      if (dmeItem.specifications) {
        specificationsSection.style.display = "block";
        let specsHtml = '';
        for (const [key, value] of Object.entries(dmeItem.specifications)) {
          specsHtml += `<li><strong>${key}:</strong> ${value}</li>`;
        }
        specifications.innerHTML = specsHtml;
      } else {
        specificationsSection.style.display = "none";
      }
      
      // Generate and update dot phrase
      dotPhraseText.value = formatDotPhrase(dmeItem);
      
      // Update diagnoses table
      if (dmeItem.recommended_diagnoses && dmeItem.recommended_diagnoses.length > 0) {
        let diagnosesHtml = '';
        dmeItem.recommended_diagnoses.forEach(dx => {
          diagnosesHtml += `
            <tr>
              <td>${dx.code}</td>
              <td>${dx.description}</td>
            </tr>
          `;
        });
        diagnosesTable.innerHTML = diagnosesHtml;
      } else {
        diagnosesTable.innerHTML = '<tr><td colspan="2">No recommended diagnoses available</td></tr>';
      }
      
      // Reset to first tab
      tabButtons.forEach(btn => btn.classList.remove("active"));
      tabContents.forEach(content => content.classList.remove("active"));
      document.querySelector('[data-tab="documentation"]').classList.add("active");
      document.getElementById("documentation-tab").classList.add("active");
      
      // Show the modal
      modal.style.display = "block";
    }
    
    function formatDotPhrase(dme) {
      const dmeId = dme.name.replace(/\s+/g, '_').replace(/[^a-zA-Z0-9_]/g, '');
      let result = `.DME_${dmeId}\n`;
      result += `*** Documentation for ${dme.name} ***\n\n`;
      
      if (dme.comment) {
        result += `Note: ${dme.comment}\n\n`;
      }
      
      result += "REQUIRED DOCUMENTATION:\n";
      if (dme.positive_documentation && dme.positive_documentation.length > 0) {
        dme.positive_documentation.forEach((doc, index) => {
          result += `${index + 1}. ${doc}\n`;
        });
      } else {
        result += "No specific documentation requirements listed.\n";
      }
      
      if (dme.negative_documentation && dme.negative_documentation.length > 0) {
        result += "\nDOCUMENT ABSENCE OF:\n";
        dme.negative_documentation.forEach((doc, index) => {
          result += `${index + 1}. ${doc}\n`;
        });
      }
      
      if (dme.specifications) {
        result += "\nSPECIFICATIONS:\n";
        for (const [key, value] of Object.entries(dme.specifications)) {
          result += `${key}: ${value}\n`;
        }
      }
      
      if (dme.recommended_diagnoses && dme.recommended_diagnoses.length > 0) {
        result += "\nRECOMMENDED DIAGNOSES:\n";
        dme.recommended_diagnoses.slice(0, 5).forEach(dx => {
          result += `${dx.code}: ${dx.description}\n`;
        });
        if (dme.recommended_diagnoses.length > 5) {
          result += `...and ${dme.recommended_diagnoses.length - 5} more diagnosis codes\n`;
        }
      }
      
      return result;
    }
  </script>
</body>
</html>